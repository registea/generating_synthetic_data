---
title: "Simulating Data"
author: "registea"
date: "23/07/2020"
output: github_document
---

<center><img src="https://github.com/registea/generating_synthetic_data/blob/master/Images/simulation.jpg?raw=true"></center>

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

# Introduction

To apply analytics and data science principles, it is necessary to have access to data. There are many places where data is freely available, some examples are:

* Kaggle
* Wiki
* Data.gov

There are instances where open source doesn't meet your precise data needs. In these scenarios, it could be the perfect opportunity to generate synthetic data, which can be built and structured to your exact requirements. 

This post is going to use base R with a little help from the tidyverse, to demonstrate how a simple customer dataset can be generated. R provides access to popular theoretical probability distributions and allows us to sample values from them. Futher to this, there is also functionality to sample from an empirical distribution. Utilising these two types of distributions, makes it very easy to generate data.

In this notebook, a dataset will be generated for 1 million customers. For each customer, data will be created to represent socio-demographics and sales information.

# Generaing data

```{r libraries, echo=FALSE, warning=FALSE, message=FALSE}

# Load libraries
library(dplyr)
```

The first step is to specify how many customers we want to have in our dataset. We will create 1 million customers in our dataset which will be denoted by the object n.

```{r n_customers}
# Number of customers
n <- 1000000
```

An empty dataframe is created with a single field created representing a customer id.

```{r dataframe_container}
# Create a dataframe
df_customer <- 
  data.frame(customer_id = 1:n,
             age = NA,
             gender = NA,
             marital_status = NA,
             no_children = NA,
             living_status = NA)
```

The next step is to simulate the age and gender of each customer. 

* Age: It is assumed that customer's age follows a normal distribution with a mean age of 35 years old and a standard deviation of 10 years old. An additional condition is added to ensure that customers are at least 18 years old, a uniform sample is taken, changing any estimated age that is below 18 to be between 18 and 29
* Gender: Using the sample function, I randomly assign customers as male or female with a distribution split of 45% and 55% respectively

```{r age_gender}
# Customer Age
df_customer$age <- round(rnorm(n, 35, 10), 0)
df_customer$age <- ifelse(df_customer$age < 18, sample(18:29, 1), df_customer$age)

# Customer gender
df_customer$gender <- sample(c('Male','Female'), size = n, prob = c(0.45, 0.55), replace = T)
```

The next fields to be populated relate to the customer's martial status, the number of children they have and their living status. These new variables will all be conditioned on the customer's age. As an example, it has been assumed that customers under 30 have a 69% probability of  being single, compared to customers over 50 having a 80% probability of being married. Categorical variables 'marital status' and 'living status' are generated by sampling from categorical vectors with specific probabilities of occurrence. The number of children that a customer has is assumed to follow a poison distribution with different lambda rates based the customer's age.

```{r marital_living_status_children}
# marital status
df_customer <-    
  mutate(df_customer, 
         marital_status = sapply(age, function(age) {
           case_when(
             age <= 30 ~ sample(c('Cohabiting','Married', 'Other', 'Single'), 
                                size = 1, 
                                prob = c(0.2, 0.1, 0.01, 0.69), 
                                replace = T),
             age <= 40 ~ sample(c('Cohabiting','Married', 'Other', 'Single'), 
                                size = 1, 
                                prob = c(0.4, 0.1, 0.01, 0.49), 
                                replace = T),
             age <= 50 ~ sample(c('Cohabiting','Married', 'Other', 'Single'), 
                                size = 1, 
                                prob = c(0.5, 0.4, 0.01, 0.29), 
                                replace = T),
             TRUE ~ sample(c('Cohabiting','Married', 'Other', 'Single'), 
                           size = 1, 
                           prob = c(0.09, 0.8, 0.01, 0.1),
                           replace = T)
             )}))


# No of children
df_customer <-    
  mutate(df_customer, 
         no_children = sapply(age, function(age) {
           case_when(
             age <= 20 ~ round(mean(rpois(n = 10, lambda = 0)), 0),
             age <= 30 ~ round(mean(rpois(n = 10, lambda = 1)), 0),
             age <= 40 ~ round(mean(rpois(n = 10, lambda = 2)), 0),
             age <= 50 ~ round(mean(rpois(n = 10, lambda = 2)), 0),
             TRUE ~ round(mean(rpois(n = 1, lambda = 3)), 0)
             )}))

# Living status
df_customer <-    
  mutate(df_customer, 
         living_status = sapply(age, function(age) {
           case_when(
             age <= 20 ~ sample(c('Living with Parents', 'Private Tenant', 'Council Tenant', 'Homeowner'), 
                                size = 1, 
                                prob = c(0.9, 0.01, 0.08, 0.01), 
                                replace = T),             
             age <= 30 ~ sample(c('Living with Parents', 'Private Tenant', 'Council Tenant', 'Homeowner'), 
                                size = 1, 
                                prob = c(0.6, 0.1, 0.1, 0.2), 
                                replace = T),
             age <= 40 ~ sample(c('Living with Parents', 'Private Tenant', 'Council Tenant', 'Homeowner'), 
                                size = 1, 
                                prob = c(0.01, 0.33, 0.33, 0.33), 
                                replace = T),
             age <= 50 ~ sample(c('Living with Parents', 'Private Tenant', 'Council Tenant', 'Homeowner'), 
                                size = 1, 
                                prob = c(0.01, 0.33, 0.33, 0.33), 
                                replace = T),
             TRUE ~ sample(c('Living with Parents', 'Private Tenant', 'Council Tenant', 'Homeowner'), 
                           size = 1, 
                           prob = c(0.0, 0.1, 0.15, 0.75),
                           replace = T)
             )}))



```

C

```{r tenure}
# Tenure
df_customer <-    
  mutate(df_customer, 
         tenure = mapply(function(age, gender)
           {
             case_when(
               age <= 20 ~ mean(rpois(n = 10, lambda = 0.5)),
               age <= 30 & gender == "Female" ~ mean(rpois(n = 10, lambda = 5)),
               age <= 30 & gender == "Male" ~ mean(rpois(n = 10, lambda = 3)),
               age <= 40 & gender == "Female" ~ mean(rpois(n = 10, lambda = 7)),
               age <= 40 & gender == "Male" ~ mean(rpois(n = 10, lambda = 9)),
               age <= 50  & gender == "Female" ~ mean(rpois(n = 10, lambda = 3)),
               age <= 50  & gender == "Male" ~ mean(rpois(n = 10, lambda = 1)),
               TRUE ~ mean(rpois(n = 10, lambda = 2))
               )
           }, age, gender))
```